<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="/__/firebase/7.12.0/firebase-app.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="/__/firebase/7.12.0/firebase-analytics.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
  <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />

  <!-- Initialize Firebase -->
  <script src="/__/firebase/init.js"></script>
  <script src="/__/firebase/7.12.0/firebase-auth.js"></script>
  <script src="/__/firebase/7.12.0/firebase-database.js"></script>
  <script src="/__/firebase/7.12.0/firebase-functions.js"></script>
  <script src='Chart.min.js'></script>
  <script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script type="text/javascript">
    var functions = firebase.functions();
    var auth = firebase.auth();
    var signingOut = false;
    auth.onAuthStateChanged(function(user) {
        if (!user) {
          if(signingOut) {
            window.location.href = "homepage.html";
          } else {
            alert("No User is logged in!");
            window.location.href = "/";
          }
        } else {
          // there is a logged in user, check if they have completed the registration process
          var checkRegistrationStatus = firebase.functions().httpsCallable('checkRegistrationStatus');
          checkRegistrationStatus({uid: auth.currentUser.uid}).then(function(result) {
            if(result.data) {
              // they have completed the registration process (account setup)
              homeClicked();
              removeLoading();
            } else {
              window.location.href = "accountsetup.html";
            }
          })

        }
    });
  </script>

  <style>
    body {
      margin: 0;
      font-family: "Lato", sans-serif;
    }

    a {
      cursor: pointer;
    }

    #mySidebar {
      z-index: 2;
    }

    #reservationsDiv #popularityChart {
          height: 100%;
          width: 100%;
        }

    .sidebaropen {
      margin: 0;
      padding: 0;
      width: 250px;
      background-color: #25262D;
      position: fixed;
      height: 100%;
      overflow: auto;
      z-index: 1;
      top: 0;
      left: 0;
      overflow-x: hidden;
      padding-top: 60px;
      transition: 0.5s;
    }

    .sidebaropen a {
      display: block;
      color: white;
      padding: 18px;
      text-decoration: none;
      border-top: 0.5px solid #606060;
      border-bottom: 0.5px solid #606060;
      /*border-bottom: 0.5px solid #606060;
      border-left: 0.5px solid #606060;*/
    }

    .sidebaropen a.active {
      background-color: #419385;
      color: white;
      text-decoration-style: bold;
    }

    .sidebaropen a:hover:not(.active) {
      background-color: #89CAD4;
      color: white;
    }

    #newResBtn {
      margin-top: 15px;
    }

    .sidebaropen .closebtn {
      position: absolute;
      top: 0;
      right: 0px;
      margin-left: 50px;
      border-width: 0px;
      font-size: 26px;
    }

    .sidebaropen a.closebtn:hover {
      color: #f1f1f1;
      background-color: #25262D;
    }

    #home {
      margin-top: 10px;
    }

    div.content {
      margin-left: 250px;
      padding: 1px 16px;
      height: 1000px;
      transition: 0.5s;
    }

    svg{
      width: 100px;
      height: 100px;
      left: 50%;
      display:inline-block;
    }
    svg circle {
      stroke: #419385;
    }
    svg rect {
      fill: #89CAD4;
    }
    #loadingAnimation {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 3;
    }

    #settingsDiv {
      margin: 0 auto;
      position: relative;
      overflow: hidden;
    }

    .notif {
      background-color: #419385;
      border-radius: 20px;
      padding: 10px;
      width: 70%;
      margin: 0 auto;
      margin-bottom: 3%;
      position: relative;
      overflow: hidden;
      transition: background-color 0.25s;
      -webkit-transition: background-color 0.25s;
    }
    .notif:hover {
      background-color: #89CAD4;
    }
    .notif p {
      color: white;
    }
    .notif #title {
      font-size: 25px;
    }
    #nonotifs {
      color: grey;
      font-style: italic;
      margin-top: 20%;
    }

    .autocomplete {
            position: relative;
            display: inline-block;
        }

        #map{
      position: relative;
      top: 20px;
      bottom: 0;
      width: 100%;
      height: 300px;
    }

        input {
            border: 1px solid transparent;
            background-color: #f1f1f1;
            padding: 10px;
            font-size: 16px;
        }

        input[type=text] {
            background-color: #f1f1f1;
            width: 100%;
        }

        button[type=submit] {
          border: 1px solid transparent;
          background-color: #f1f1f1;
          background-color: DodgerBlue;
          padding: 10px;
          font-size: 16px;
          color: #fff;
          cursor: pointer;
        }

        #confirmButton {
          margin-top: 5px;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            /*position the autocomplete items to be the same width as the container:*/
            top: 100%;
            left: 0;
            right: 0;
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }

        /*when hovering an item:*/
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        /*when navigating through the items using the arrow keys:*/
        .autocomplete-active {
            background-color: DodgerBlue !important;
            color: #ffffff;
        }

        a.disabled {
          pointer-events: none;
          cursor: default;
        }

        table {
          font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
          border-collapse: collapse;
          width: 100%;
          margin-top: 20px;
        }

        td, th {
          border: 1px solid #ddd;
          padding: 8px;
        }

        tr:nth-child(even){background-color: #f2f2f2;}

        tr:hover {background-color: #ddd;}

        th {
          padding-top: 12px;
          padding-bottom: 12px;
          text-align: left;
          background-color: #4CAF50;
          color: white;
        }

  #searchArea {
    width: 20%;
    height: 400px;
    overflow:auto;
    position: absolute;
    z-index:1;
    }

    #dataArea {
      position: relative;
    }

    .countryListItem {
      width: 100%;
      background-color: #EEEEEE;
      border-radius: 5px;
    }

    #dataOverTimeChartContainer {
      background-color: #EEEEEE;
      border-radius: 5px;
      margin: 30px;
    }

    #twitterContainer {
      border-radius: 5px;
      margin: 30px;
    }

    #chartContainer {
      margin-top: 30px;
    }

    #items {
      
    }

    .card {
      width: 15rem;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    @media screen and (max-width: 700px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
      }
      .sidebar a {float: left;}
      div.content {margin-left: 0;}
    }

    @media screen and (max-width: 800px) {
      #dataOverTimeChartContainer {
        width: 400px !important;
      }
    }

    @media screen and (max-width: 400px) {
      .sidebar a {
        text-align: center;
        float: none;
      }
    }

    @media screen and (max-height: 450px) {
      .sidebar {padding-top: 15px;}
      .sidebar a {font-size: 18px;}
    }
  </style>
  </head>
  <body onload="displayLoading();">

    <div id="fullBackgroundContainer">
      <div id="loadingAnimation" class="center" hidden=true>
    <svg version="1.1" id="L1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
    <circle fill="none" stroke-width="6" stroke-miterlimit="15" stroke-dasharray="14.2472,14.2472" cx="50" cy="50" r="47" >
      <animateTransform
         attributeName="transform"
         attributeType="XML"
         type="rotate"
         dur="5s"
         from="0 50 50"
         to="360 50 50"
         repeatCount="indefinite" />
  </circle>
  <circle fill="none" stroke="#fff" stroke-width="1" stroke-miterlimit="10" stroke-dasharray="10,10" cx="50" cy="50" r="39">
      <animateTransform
         attributeName="transform"
         attributeType="XML"
         type="rotate"
         dur="5s"
         from="0 50 50"
         to="-360 50 50"
         repeatCount="indefinite" />
  </circle>
  <g fill="#fff">
  <rect x="30" y="35" width="5" height="30">
    <animateTransform
       attributeName="transform"
       dur="1s"
       type="translate"
       values="0 5 ; 0 -5; 0 5"
       repeatCount="indefinite"
       begin="0.1"/>
  </rect>
  <rect x="40" y="35" width="5" height="30" >
    <animateTransform
       attributeName="transform"
       dur="1s"
       type="translate"
       values="0 5 ; 0 -5; 0 5"
       repeatCount="indefinite"
       begin="0.2"/>
  </rect>
  <rect x="50" y="35" width="5" height="30" >
    <animateTransform
       attributeName="transform"
       dur="1s"
       type="translate"
       values="0 5 ; 0 -5; 0 5"
       repeatCount="indefinite"
       begin="0.3"/>
  </rect>
  <rect x="60" y="35" width="5" height="30" >
    <animateTransform
       attributeName="transform"
       dur="1s"
       type="translate"
       values="0 5 ; 0 -5; 0 5"
       repeatCount="indefinite"
       begin="0.4"/>
  </rect>
  <rect x="70" y="35" width="5" height="30" >
    <animateTransform
       attributeName="transform"
       dur="1s"
       type="translate"
       values="0 5 ; 0 -5; 0 5"
       repeatCount="indefinite"
       begin="0.5"/>
  </rect>
  </g>
</svg>
  </div>


      <div id="mySidebar" class="sidebaropen">
        <a class="closebtn" id="closebtn" onclick="navOperator()" data-open=true>&times;</a>
        <a id="home" onclick="homeClicked();">Home</a>
        <a id="notifications" onclick="notificationsClicked()">Notifications</a>
        <a id="reservations" onclick="reservationsClicked();">Reservations</a>
        <a id="requests" onclick="requestsClicked();">Requests</a>
        <a id="news" onclick="newsClicked();">Covid-19 Awareness</a>
        <a id="settings" onclick="settingsClicked();">Settings</a>
        <a id="logout" onclick="logout();">Logout</a>

      </div>

      <!--<div id="main">
        <button class="openbtn" onclick="openNav()">&#9776; Open Sidebar</button>
      </div>-->

      <div class="content" id="contentDiv">
        <div id="homeDiv">
          <h1>Home</h1>
          <div align="right">
            <button id="addFriendsBtn" type="button" class="btn btn-primary" onclick="addFriendsClicked();">
              Add Friends
            </button>
            <table id="friendsTable"></table>
            <div id="addFriendDiv" hidden>
              <div class="form-group">
                <label for="friendEmail">Email address of the user you wish to add</label>
                <input type="email" class="form-control" id="friendEmail" placeholder="Enter email">
                <div align="center">
                  <button class="btn btn-primary" onclick="sendFriendRequest();">Send Friend Request</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="notificationsDiv"></div>

        <div id="reservationsDiv">
          <div align="right">
            <button id="newResBtn" type="button" class="btn btn-primary" onclick="newReservationClicked();">
              New Reservation
            </button>
          </div>

          <table id="reservationsTable"></table>

          <div id="newReservationDiv" hidden>
            <div class="autocomplete" style="width:300px;">
              <input id="myInput" type="text" name="myCountry" placeholder="location">
            </div>
            <button type="submit" onclick="reservationSubmitClicked()">Submit</button>
            <div id="map"></div>
            <div id="chartContainer" style="height: 0px; width: 100%;"></div>
            <h3 id="selectedReservationTime">Selected Time</h3>
            <div id="timeselector">
              <input id="resTimePicker" type="text" class="timepicker" placeholder="Select Time">
            </div>
            <div align="center">
              <button type="submit" id="reserveButton" onclick="reserveButtonClicked()">Reserve</button>
            </div>
          </div>
        </div>

        <div id="requestsDiv" class="container">
          <div id="header" class="page-header">
            <h1>Requests</h1>
          </div>
          <div id="io" class="jumbotron">
            <div id="searchBox" class="input-group mb-3">
              <input id="itemSearchInput" type="text" placeholder="Search for items" class="form-control">
              <div id="searchBoxBtn" class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="getItems();">Search</button>
              </div>
            </div>
            <div id="items">

            </div>
            <div id="header">
              <h4>Grocery List</h4>
            </div>
              <div id="groceryList" class="card-deck" align="center">
            </div>
          </div>
        </div>

        <div id="newsDiv" class="container">
          <div style = "position: relative; width: 100%; height:100%; overflow: none;">
            <div id="header" class="page-header">
              <h1>Covid-19 Awareness</h1>
            </div>
          <input id="countrySearchInput" type="text" onkeydown="filterCountries()" placeholder="Search..">
          <div id = "searchArea"></div>
          <div id = "dataArea"></div>
          <div id = "dataOverTimeChartContainer" style = "width: 60%; height:50%; float:left;">
          <canvas id = "dataOverTimeChart"></canvas>
          </div>
          <div id = "twitterContainer">
          <a class="twitter-timeline" data-width="300" data-height="400" data-theme="dark" href="https://twitter.com/WHO?ref_src=twsrc%5Etfw">Tweets by WHO</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </div>
        </div>
        </div>

        <div id="settingsDiv" class="container">
          <div id="header" class="page-header">
            <h1>Settings</h1>
          </div>
          <div id="form" class="jumbotron">
            <form action="#" id="changes" method="post">
              <div id="selMed" class="form-group">
                <label for="medSelect">Medical Condition<b data-toggle="tooltip" title="Any conditions that poses you at a higher risk, e.g., asthma, chronic lung disease, heart conditions, immunocompromised, etc.">?</b></label>
                <select class="form-control" id="medSelect">
                  <option id="selNo">No</option>
                  <option id="selYes">Yes</option>
                </select>
              </div>
              <div id="selHelper" class="form-group">
                <label for="helperSelect">Helper<b data-toggle="tooltip" title="Person who volunteers to help people in need. This option can be changed in account settings later.">?</b></label>
                <select class="form-control" id="helperSelect" onchange="helperSelectValChanged();">
                  <option id="selNo">No</option>
                  <option id="selYes">Yes</option>
                </select>
              </div>
              <div id="selRad" class="form-group">
                <label for="radiusSelect">Preferred radius (miles)</label>
                <select class="form-control" id="radiusSelect">
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                </select>
              </div>
            </form>
            <div id="changePasswd" align="center">
              <input id="changePw" type="button" class="btn" onclick="changePasswordClicked();" value="Change Password">
            </div>
            <div id="confirmButton" align="center" onclick="saveSettingsClicked();">
              <input id="confirm" type="button" class="btn" value="Save Changes">
            </div>
          </div>
        </div>
      </div>
    </div>


    <script type="text/javascript">
      function makeActive(id) {
        document.querySelectorAll(".active").forEach(e => {e.classList.remove("active")});
        document.getElementById(id).classList.add("active");
        //let contentDiv = document.getElementById("contentDiv");
        let childNodes = $("#contentDiv").children();
        let div = document.getElementById(id+"Div");
        for(var i=0;i<childNodes.length;i++) {
          if(childNodes[i].id == div.id) {
            $("#"+id+"Div").show();
            continue;
          } else {
            $("#"+childNodes[i].id).hide();
          }
        }
        //window.scrollTo(0, 0)
      }

      function displayLoading() {
        $('#fullBackgroundContainer *').attr("disabled", "disabled").off('click');
        document.getElementById('loadingAnimation').hidden = false;
        document.getElementById("home").classList.add("disabled");
        document.getElementById("notifications").classList.add("disabled");
        document.getElementById("reservations").classList.add("disabled");
        document.getElementById("requests").classList.add("disabled");
        document.getElementById("news").classList.add("disabled");
        document.getElementById("settings").classList.add("disabled");
        document.getElementById("logout").classList.add("disabled");
      }

      function removeLoading() {
        $('#fullBackgroundContainer *').attr("disabled", false).on('click');
        document.getElementById("home").classList.remove("disabled");
        document.getElementById("notifications").classList.remove("disabled");
        document.getElementById("reservations").classList.remove("disabled");
        document.getElementById("requests").classList.remove("disabled");
        document.getElementById("news").classList.remove("disabled");
        document.getElementById("settings").classList.remove("disabled");
        document.getElementById("logout").classList.remove("disabled");
        document.getElementById("logout").classList.add("disabled");
        document.getElementById('loadingAnimation').hidden = true;
      }

      function navOperator() {
        // opens or closes the tag depending on current state
        if(document.getElementById('closebtn').dataset.open == "true") {
          document.getElementById('closebtn').dataset.open = "false";
          document.getElementById("mySidebar").style.width = "50px";
          document.getElementById("contentDiv").style.marginLeft = "50px"
          document.getElementById("closebtn").innerHTML = "&#9776";
          document.getElementById("home").innerHTML = "<i class='glyphicon glyphicon-home'></i>";
          document.getElementById("notifications").innerHTML = "<i class='glyphicon glyphicon-bell'></i>";
          document.getElementById("reservations").innerHTML = "<i class='glyphicon glyphicon-book'></i>";
          document.getElementById("requests").innerHTML = "<i class='glyphicon glyphicon-shopping-cart'></i>";
          document.getElementById("news").innerHTML = "<i class='glyphicon glyphicon-bullhorn'></i>";
          document.getElementById("settings").innerHTML = "<i class='glyphicon glyphicon-cog'></i>";
          document.getElementById("logout").innerHTML = "<i class='glyphicon glyphicon-log-out'></i>";
        } else {
          document.getElementById('closebtn').dataset.open = "true";
          document.getElementById("mySidebar").style.width = "250px";
          document.getElementById("contentDiv").style.marginLeft = "250px"
          document.getElementById("closebtn").innerHTML = "&times";
          document.getElementById("home").innerHTML = "Home";
          document.getElementById("notifications").innerHTML = "Notifications";
          document.getElementById("reservations").innerHTML = "Reservations";
          document.getElementById("requests").innerHTML = "Requests";
          document.getElementById("news").innerHTML = "Covid-19 Awareness";
          document.getElementById("settings").innerHTML = "Settings";
          document.getElementById("logout").innerHTML = "Logout";
        }
      }

      function helperSelectValChanged() {
        console.log("changed");
        var radiusSelector = document.getElementById("radiusSelect");
        if(document.getElementById("helperSelect").value != "Yes") {
          radiusSelector.value = null;
          radiusSelector.disabled = true;
        } else {
          radiusSelector.disabled = false;
          radiusSelector.value = 1;
        }
      }

      function changePasswordClicked() {
        let confirmation = confirm("Are you sure that you would like to change your password? An email will be sent to you to enable you to do so.")
        if(confirmation) {
          displayLoading();
          auth.sendPasswordResetEmail(auth.currentUser.email).then(function(result) {
            alert("An email has been sent to you with a password reset link.");
            removeLoading();
          }).catch(function(error) {
            alert("For security reasons, you will have to be logged out. Upon logging back in with your credentials, you will be able to attempt to complete this action again.");
            auth.signOut();
          })
        }
      }

      function saveSettingsClicked() {
        displayLoading();
        var medConds = document.getElementById("medSelect").value;
        var helper = document.getElementById("helperSelect").value;
        var radius = helper == "Yes" ? document.getElementById("radiusSelect").value : null;
        data = {uid: auth.currentUser.uid, medConditions: medConds, helper: helper, radius: radius};
        var updateSettingsData = firebase.functions().httpsCallable('updateSettingsData');
        updateSettingsData(data).then(function(result) {
          alert("Settings updated!");
          removeLoading();
        }).catch(function(error) {
          console.log(error);
          alert("An alert occured while updating settings.");
          removeLoading();
        })
      }

      function newReservationClicked() {
        $('#newReservationDiv').dialog({
          height: window.innerHeight*0.8,
          width: window.innerWidth*0.8,
          modal: true,
          resizable: false,
          draggable: false
        });
      }

      function getRank(score) {
        if(score < 10) {
          return 'Beginner';
        } else if(score < 30) {
          return 'Novice'
        } else if(score < 50) {
          return 'Graduate'
        } else if(score < 70) {
          return 'Expert'
        } else if(score < 100) {
          return 'Master'
        } else if(score < 150) {
          return 'Grand Master'
        } else {
          return 'Legend'
        }
      }

      function homeClicked() {
        makeActive("home");
        // fetch the list of the persons friends
        displayLoading();
        var getFriends = firebase.functions().httpsCallable('getFriends');
        var getUserScore = firebase.functions().httpsCallable('getUserScore');
        var table = document.getElementById("friendsTable");
        table.innerHTML = "<tr><th>Rank</th><th>Name</th><th>Score</th>";
        getFriends({uid: auth.currentUser.uid}).then(result => {
          Object.keys(result.data).forEach(key => {
            var row = document.createElement('tr');
            let nameVal = result.data[key].firstName + ' ' + result.data[key].lastName;
            var name = document.createElement('td');
            name.innerHTML = nameVal;
            getUserScore({uid: result.data[key].uid}).then(score_result => {
              let scoreVal = score_result.data;
              var score = document.createElement('td');
              score.innerHTML = scoreVal;
              let rankVal = getRank(scoreVal);
              var rank = document.createElement('td');
              rank.innerHTML = rankVal;
              row.appendChild(rank);
              row.appendChild(name);
              row.appendChild(score);
              table.appendChild(row);
            })
          })
          removeLoading();
        }).catch(error => {
          removeLoading();
          alert('An error occured while fetching your friends data. Please try again later.');
          console.log(error);
        })
      }

      function notificationsClicked() {
        makeActive("notifications");
        displayLoading();
        let notificationsDiv = document.getElementById("notificationsDiv");
        // clearing the div to get rid of previous notifications
        notificationsDiv.innerHTML = "";
        var title = document.createElement("h1");
        title.id = "notifsTitle";
        title.innerHTML = "Notifications";
        notificationsDiv.appendChild(title);
        var notifGet = firebase.functions().httpsCallable('getNotificationsForUser');
        notifGet({uid: auth.currentUser.uid}).then(function(result) {
          var data = result.data;
          if(Object.keys(result.data).length > 0) {

            Object.keys(result.data).forEach(function(key) {
              var notifDiv = document.createElement("div");
              notifDiv.classList.add("notif");
              var title = document.createElement("p");
              title.id = "title";
              title.innerHTML = result.data[key].title;
              var text = document.createElement("p");
              text.id = "text";
              text.innerHTML = result.data[key].text;
              var date = document.createElement("p");
              date.id = "date";
              date.innerHTML = result.data[key].date;
              notifDiv.appendChild(title);
              notifDiv.appendChild(text);
              notifDiv.appendChild(date);
              if(result.data[key].type == "friend-request") {
                notifDiv.onclick = function() {
                  friendRequestClicked(result.data[key].originUserUID);
                }
              }
              notificationsDiv.appendChild(notifDiv);
            });
          } else {
            // no notifications to show to the user
            var nope = document.createElement("p");
            nope.id = "nonotifs";
            nope.align = "center";
            nope.innerHTML = "No notifications to display.";
            notificationsDiv.appendChild(nope);
          }
        })
        removeLoading();
      }

      function friendRequestClicked(uid, email) { // the uid here is the originUserUID
        let notificationsDiv = document.getElementById("notificationsDiv");
        let data = {originUserUID: uid, userUID: auth.currentUser.uid};
        if(confirm("Dou you wish to accept this friend request?")) {
          var confirmRequest = firebase.functions().httpsCallable('confirmFriendRequest');
          confirmRequest(data).then(result => {
            notificationsClicked();
          }).catch(error => {
            console.log(error);
            alert("An error occured, please try again later!");
            notificationsClicked();
          })
        } else {
          var deleteRequest = firebase.functions().httpsCallable('deleteFriendRequest');
          deleteRequest(data).then(result => {
            notificationsClicked();
          }).catch(error => {
            console.log(error);
            alert("An error occured, please try again later!");
            notificationsClicked();
          })
        }
      }

      function reservationsClicked() {
        makeActive("reservations");
        $("#nonotifs").remove();
        var elems = document.querySelectorAll('.timepicker');
        var instances = M.Timepicker.init(elems, {container: "#timeselector",
          twelveHour: false,
          vibrate: true
        })
        displayLoading();
        var getReservations = firebase.functions().httpsCallable('getReservationsForUser');
        getReservations({uid: auth.currentUser.uid}).then(result => {
          console.log(result.data);
          if(result.data) {
            var table = document.getElementById("reservationsTable");
            table.innerHTML = "<tr><th>Time</th><th>Address</th></tr>";
            Object.keys(result.data).forEach(key => {
              var row = document.createElement('tr');
              var address = document.createElement('td');
              address.innerHTML = result.data[key].address;
              var time = document.createElement('td');
              var timeVal = new Date(result.data[key].time);
              time.innerHTML = timeVal.toLocaleDateString() + ' ' + timeVal.toTimeString().substr(0, 5);
              row.appendChild(time);
              row.appendChild(address);
              table.appendChild(row);
            })
          } else {
            var nope = document.createElement("p");
            nope.id = "nonotifs";
            nope.align = "center";
            nope.innerHTML = "No reservations to show.";
            document.getElementById('reservationsDiv').appendChild(nope);
          }
          removeLoading();
        }).catch(error => {
          console.log(error);
          alert("An error occured while fetching your reservations. Please try again later.");
          removeLoading();
        })
      }

      function reserveButtonClicked() {
        // add reservation to the database
        var input = $("#myInput")
        let address = input.val()
        if(!address) {
          alert("Please select a location!");
        } else {
          let lat = input.attr("data-lat");
          let lng = input.attr("data-lng");
          if(!lat || !lng) {
            alert("Invalid Location!");
          } else {
            let time = document.getElementById("resTimePicker").value;
            if(!time) {
              alert("Please Choose a Valid Time")
            } else {
              var today = new Date();
              var date = (today.getMonth() + 1) + '/' + today.getDate() + '/' + today.getFullYear()
              var datetime = new Date(date + ' ' + time);
              console.log(datetime);
              console.log(today);
              if(datetime.getTime() < today.getTime()) {
                alert("Please choose a valid time that is in the future!");
              } else {
                displayLoading();
                let reservationData = {uid: auth.currentUser.uid,
                  lat: lat,
                  lng: lng,
                  address: address,
                  datetime: datetime.getTime()};
                var newReservation = firebase.functions().httpsCallable('newReservation');
                newReservation(reservationData).then(function(result) {
                  console.log(result);
                  $('#newReservationDiv').dialog('close')
                  reservationsClicked();
                }).catch(function(error) {
                  console.log(error);
                  alert("A problem occured, try again later.")
                  $('#newReservationDiv').dialog('close')
                  reservationsClicked();
                })
              }
            }
          }
        }

      }

      async function getCovidDateOverTime() {
        const dataPromise = await fetch("https://pomber.github.io/covid19/timeseries.json");
        const data = dataPromise.json();
        return data;
      }

      async function getCovidDataByCountry(name) {
        const dataPromise = await fetch("https://covid-19-data.p.rapidapi.com/country?format=undefined&name=" + (name), {
          "method": "GET",
	        "headers": {
            "x-rapidapi-host": "covid-19-data.p.rapidapi.com",
		        "x-rapidapi-key": "1b4410c01fmsh3769100e666f5eep19c99djsna2c20ca475db"
	         }
        })
        const data = dataPromise.json()
        return data;
      }

      function addListElement (parentID, country) {
        var parent = document.getElementById(parentID);
        var newItem = document.createElement("div");
        newItem.innerHTML = '<button id = "' + country + '" class = "countryListItem"> ' + country + '</button>'
        parent.appendChild(newItem)
      }

      function filterCountries() {
        var searchArea = document.getElementById("searchArea");
        searchArea.innerHTML = "";
        var countries = ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria",
        "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina",
        "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile",
        "China", "Colombia", "Congo (Brazzaville)", "Congo (Kinshasa)", "Costa Rica", "Cote d'Ivoire", "Croatia", "Diamond Princess", "Cuba", "Cyprus",
        "Czechia", "Denmark", "Djibouti", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini",
        "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Guatemala", "Guinea", "Guyana", "Haiti",
        "Holy See", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan",
        "Kazakhstan", "Kenya", "Korea, South", "Kuwait", "Kyrgyzstan", "Latvia", "Lebanon", "Liberia", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar",
        "Malaysia", "Maldives", "Malta", "Mauritania", "Mauritius", "Mexico", "Moldova",
        "Monaco", "Mongolia", "Montenegro", "Morocco", "Namibia", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia",
        "Norway", "Oman", "Pakistan", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia",
        "Rwanda", "Saint Lucia", "Saint Vincent and the Grenadines", "San Marino", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Singapore", "Slovakia",
        "Slovenia", "Somalia", "South Africa", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Taiwan*", "Tanzania", "Thailand", "Togo",
        "Trinidad and Tobago", "Tunisia", "Turkey", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "Uruguay", "US", "Uzbekistan", "Venezuela",
        "Vietnam", "Zambia", "Zimbabwe", "Dominica", "Grenada", "Mozambique", "Syria", "Timor-Leste", "Belize", "Laos", "Libya", "West Bank and Gaza", "Guinea-Bissau",
        "Mali", "Saint Kitts and Nevis", "Kosovo", "Burma", "MS Zaandam", "Botswana", "Burundi", "Sierra Leone", "Malawi"]
        var filteredCountries = countries.filter( function (country) {
          return country.toLowerCase().indexOf(document.getElementById("countrySearchInput").value.toLowerCase()) !== -1
        });
        filteredCountries.forEach(item => addListElement("searchArea", item));
        console.log(filteredCountries);
      }

      async function newsClicked() {
        makeActive("news");
        document.addEventListener('click', async function (event) {
           if (event.target.classList.contains('countryListItem')) {
             document.getElementById("searchArea").innerHTML = "";
             const allData = await getCovidDateOverTime();
             allCountryData = allData[event.target.id];
             console.log(dataItaly);
             confirmedCountryData = allCountryData.map(function(value, index) { return value.confirmed });
             config.data.datasets[0].data = confirmedCountryData
             console.log(confirmedCountryData);
             deathsCountryData = allCountryData.map(function(value, index) { return value.deaths });
             console.log(deathsCountryData);
             config.data.datasets[1].data = deathsCountryData
             labelsCountryData = allCountryData.map(function(value, index) { return value.date });
             config.data.labels = labelsCountryData;
             config.options.title.text = event.target.id;
             console.log(labelsCountryData);
             myChart.update();
             document.getElementById('dataOverTimeChart').style.display = "block";
           }}, false);
        const data = await getCovidDateOverTime();
        console.log(data);
        console.log(Object.keys(data))
        dataItaly = data["Italy"]
        var ctx = document.getElementById('dataOverTimeChart').getContext('2d');
        labelsItaly = dataItaly.map(function(value, index) { return value.date });
        console.log(labelsItaly);
        var config = {
			type: 'line',
			data: {
				labels: labelsItaly,
				datasets: [{
					label: 'Confirmed Cases',
					backgroundColor: "red",
					borderColor: "red",
					data: [],
					fill: false,
          pointRadius: 2,
				}, {
					label: 'Confirmed Deaths',
					fill: false,
					backgroundColor: "blue",
					borderColor: "blue",
          pointRadius: 2,
					data: [],
				}]
			},
			options: {
				// responsive: true,
				title: {
					display: true,
					text: 'Chart.js Line Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					x: {
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					},
					y: {
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}
				}
			}
		};
        var myChart = new Chart(ctx, config);
      }

      function settingsClicked() {
        makeActive("settings");
        displayLoading();
        var medSelector = document.getElementById("medSelect");
        var helperSelector = document.getElementById("helperSelect");
        var radiusSelector = document.getElementById("radiusSelect");
        var getSettingsData = firebase.functions().httpsCallable('getSettingsData');
        getSettingsData({uid: auth.currentUser.uid}).then(function(result) {
          medSelector.value = result.data.medConditions ? result.data.medConditions : "No";
          helperSelector.value = result.data.helper;
          radiusSelector.value = result.data.radius;
          helperSelectValChanged();
          removeLoading();
        }).catch(function(error) {
          console.log(error);
          alert("An error occured while fetching your current settings.");
          removeLoading();
        })
      }

      function requestsClicked() {
        makeActive("requests");
        console.log("clicked");
        const groceryList = document.getElementById('groceryList');
        const dbRefObject = firebase.database().ref('/users/'+auth.currentUser.uid+'/groceryList')
        dbRefObject.on('value', snap => {
          let data = snap.val();
          Object.keys(data).forEach(key => {
            addItem(data[key].src, data[key].txt, false);
          })
        });
      }

      function logout() {
        signingOut = true;
        auth.signOut();
      }

      makeActive("home");

    </script>

    <script>
// scripts for the reservation page
  var coordsLng;
  var coordsLat;
  var map;
  var selectedLocationMarker;

  function setCurrentPos(position) {
    console.log('here1')
    coordsLng = position.coords.longitude;
    coordsLat = position.coords.latitude;
    setMapToCurrentPos(position)
  }

  function setMapToCurrentPos(position) {
    console.log('here')
    mapboxgl.accessToken = 'pk.eyJ1IjoiaHVjY2FsIiwiYSI6ImNrODdta3FwYTAxaTAzbW1lbjZ3dXc2bTYifQ.bCvPCM3ThA-UbWLF4-Eqnw';
    map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [position.coords.longitude, position.coords.latitude],
    zoom: 13
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(
      new mapboxgl.GeolocateControl({
        positionOptions: {
          enableHighAccuracy: true
        },
        trackUserLocation: true
      })
    );

    var marker = new mapboxgl.Marker({
    draggable: true
    })
    .setLngLat([position.coords.longitude, position.coords.latitude])
    .addTo(map);
    marker.on('dragend', onDragEnd);
  }

  function setMapToPredefinedPos() {
    mapboxgl.accessToken = 'pk.eyJ1IjoiaHVjY2FsIiwiYSI6ImNrODdta3FwYTAxaTAzbW1lbjZ3dXc2bTYifQ.bCvPCM3ThA-UbWLF4-Eqnw';
    map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-0.13044, 51.5099],
    zoom: 13
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(
      new mapboxgl.GeolocateControl({
        positionOptions: {
          enableHighAccuracy: true
        },
        trackUserLocation: true
      })
    );

    var marker = new mapboxgl.Marker({
    draggable: true
    })
    .setLngLat([-0.13044, 51.5099])
    .addTo(map);
    marker.on('dragend', onDragEnd);
    coordsLng = -0.13044;
    coordsLat = 51.5099;
  }

  function onDragEnd() {
    var lngLat = marker.getLngLat();
    coordinates.style.display = 'block';
    coordinates.innerHTML =
    'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
  }

  navigator.geolocation.getCurrentPosition(setCurrentPos, setMapToPredefinedPos);

    var geocodingClient = mapboxSdk({accessToken: 'pk.eyJ1IjoiYmd1cm5lZXQiLCJhIjoiY2s4aXBteG42MDNmYTNtbzB4Z2FjeXFxcSJ9.38w36WEgv4HqjYTNiPcz_Q'});

    function autocompleteSuggestionMapBoxAPI(inputParams, callback) {
        geocodingClient.geocoding.forwardGeocode({
            query: inputParams,
            proximity: [coordsLng, coordsLat],
            types: ["poi", "postcode"],
            autocomplete: true,
            limit: 10,
        })
            .send()
            .then(response => {
                const match = response.body;
                var features = [];
                match.features.forEach(function(value) {
                  if(value.properties.category.includes("super") || value.properties.category.includes("groceries") || value.properties.category.includes("grocery") || value.properties.category.includes("market") || value.properties.category.includes("store") || value.properties.category.includes("minimart") || value.properties.category.includes("mini mart") || value.properties.category.includes("convenience")) {
                    features.push(value);
                  }
                })
                callback(features.slice(0, 5));
            });
    }

    function autocompleteInputBox(inp) {
        var currentFocus;
        inp.addEventListener("input", function (e) {
            var a, b, i, val = this.value;
            closeAllLists();
            if (!val) {
                return false;
            }
            currentFocus = -1;
            a = document.createElement("DIV");
            a.setAttribute("id", this.id + "autocomplete-list");
            a.setAttribute("class", "autocomplete-items");
            this.parentNode.appendChild(a);

            // suggestion list MapBox api called with callback
            autocompleteSuggestionMapBoxAPI($('#myInput').val(), function (results) {
              console.log(results);
                results.forEach(function (key) {
                    b = document.createElement("DIV");
                    b.innerHTML = "<strong>" + key.place_name.substr(0, val.length) + "</strong>";
                    b.innerHTML += key.place_name.substr(val.length);
                    b.innerHTML += "<input type='hidden' data-lat='" + key.geometry.coordinates[1] + "' data-lng='" + key.geometry.coordinates[0] + "'  value='" + key.place_name + "'>";
                    b.addEventListener("click", function (e) {
                        let lat = $(this).find('input').attr('data-lat');
                        let long = $(this).find('input').attr('data-lng');
                        inp.value = $(this).find('input').val();
                        $(inp).attr('data-lat', lat);
                        $(inp).attr('data-lng', long);
                        if(selectedLocationMarker) {
                          selectedLocationMarker.remove();
                        }
                        selectedLocationMarker = new mapboxgl.Marker()
            .setLngLat([long, lat])
            .addTo(map);
            map.fitBounds([[coordsLng, coordsLat], [long, lat]]);
                        closeAllLists();
                    });
                    a.appendChild(b);
                });
            })
        });


        /*execute a function presses a key on the keyboard:*/
        inp.addEventListener("keydown", function (e) {
            var x = document.getElementById(this.id + "autocomplete-list");
            if (x) x = x.getElementsByTagName("div");
            if (e.keyCode == 40) {
                /*If the arrow DOWN key is pressed,
                increase the currentFocus variable:*/
                currentFocus++;
                /*and and make the current item more visible:*/
                addActive(x);
            } else if (e.keyCode == 38) { //up
                /*If the arrow UP key is pressed,
                decrease the currentFocus variable:*/
                currentFocus--;
                /*and and make the current item more visible:*/
                addActive(x);
            } else if (e.keyCode == 13) {
                /*If the ENTER key is pressed, prevent the form from being submitted,*/
                e.preventDefault();
                if (currentFocus > -1) {
                    /*and simulate a click on the "active" item:*/
                    if (x) x[currentFocus].click();
                }
            }
        });

        function addActive(x) {
            /*a function to classify an item as "active":*/
            if (!x) return false;
            /*start by removing the "active" class on all items:*/
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            /*add class "autocomplete-active":*/
            x[currentFocus].classList.add("autocomplete-active");
        }

        function removeActive(x) {
            /*a function to remove the "active" class from all autocomplete items:*/
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
            }
        }

        function closeAllLists(elmnt) {
            /*close all autocomplete lists in the document,
            except the one passed as an argument:*/
            var x = document.getElementsByClassName("autocomplete-items");
            for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                    x[i].parentNode.removeChild(x[i]);
                }
            }
        }

        /*execute a function when someone clicks in the document:*/
        document.addEventListener("click", function (e) {
            closeAllLists(e.target);
        });
    }

    function reservationSubmitClicked() {
      displayLoading();
      let address = $("#myInput").val()
      let query = "https://bgurneet.pythonanywhere.com/api/v2/getbusytimes?address="+address;
      console.log(query);
      $.getJSON(query)
      .done(result => {
        document.getElementById('chartContainer').style = "height: 300px; width: 100%;"
        let data = result.data;
        Object.keys(data).forEach(key => {
          let dataset = data[key]['data'];
          console.log(dataset)
          var datapoints = [];
          for(var i=0; i<dataset.length;i++) {
            datapoints.push({label: dataset[i][0]+":00", y: dataset[i][1]});
          }
          console.log(datapoints);
          var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            theme: "light2",
            title: {
              text: "Popularity of selected location"
            },
            data: [{
              type: "column",
              click: timeSelected,
              dataPoints: datapoints,
            }]
          })
          chart.render();
        })
      }).fail(error => {
        let container = document.getElementById("chartContainer");
        chartContainer.innerHTML = "<h3>Popular Times Not Available</h3>";
        chartContainer.style = "height: 100px; width: 100%;"

      }).always(function() { 
        removeLoading();
      })
    }

    function timeSelected(e) {
      document.getElementById("resTimePicker").value = e.dataPoint.label

    }

    autocompleteInputBox(document.getElementById("myInput"));
</script>

<script type="text/javascript">
  // scripts for the home page
  function addFriendsClicked() {
    $('#addFriendDiv').dialog({
      width: window.innerWidth*0.8,
      modal: true,
      resizable: false,
      draggable: false
    });
  }

  function sendFriendRequest() {
    var friendEmail = $('#friendEmail').val();
    var userEmail = auth.currentUser.email;
    if(friendEmail == userEmail) {
      alert("You cannot send yourself a friend request!");
    } else {
      var uid = auth.currentUser.uid;
      var date = (new Date()).toLocaleDateString();
      data = {friendEmail: friendEmail,
        userEmail: userEmail,
        uid: uid,
        date: date};
      var sendFriendRequest = firebase.functions().httpsCallable('sendFriendRequest');
      sendFriendRequest(data).then(result => {
        $('#addFriendDiv').dialog('close');
        alert("Friend Request Sent!");
      }).catch(error => {
        console.log(error);
        alert("An error occured, please try again later.");
      })
    }
  }
</script>

<script>
  const pre = "https://uk.openfoodfacts.org/cgi/search.pl?search_terms=";
    //const pro = "&search_simple=1&action=process&json=true"
    const pro = "&action=process&json=true"
    var data;
    var item;
    var container = document.getElementById("items");
    var grocery = document.getElementById("groceryList");

    let list = [];
    //const buttonNode = document.createTextNode('Add');

    async function getItems(){
      container.innerHTML = "";
      item = document.getElementById('itemSearchInput').value;
      const response = await fetch(pre + item + pro);
      data = await response.json();
      console.log(data);
      if(Object.keys(data.products).length == 0){
        let notFound = document.createElement('p');
        let notFoundText = document.createTextNode("The item was not found.");
        notFound.appendChild(notFoundText);
        container.appendChild(notFound);
      }
      else{
        showItems();
      }
      //var pageSize = data.page_size;
    }

    function showItems(){
      var count = Object.keys(data.products).length;
      //console.log(count);
      //var num = 1;


      var cardDeck = 1;
      for(j=1; j<=cardDeck; j++){
        var deck = document.createElement('div');
        deck.className = "card-deck";
        deck.align = "center";
        for(let i=0; i<count; i++){
          let path = data.products[i].product_name;
          let event = document.createElement('div');
          let card = document.createElement('div');
          let cardBody = document.createElement('div');
          let img = document.createElement('img');
          let src = data.products[i].image_front_url;
          let name = document.createElement('h5');
          let node = document.createTextNode(path);
          let button = document.createElement('input');

          // card settings
          card.className = "card";


          if (typeof src == "undefined"){
            src = "https://static.openfoodfacts.org/images/svg/product-silhouette.svg";
          }
          img.src = src;
          //img.className = "img-thumbnail";
          img.className = "card-img-top";
          img.width = "100";
          img.height = "100";
          img.alt = "Card image cap";
          card.appendChild(img);

          cardBody.className = "card-body";
          name.appendChild(node);
          cardBody.appendChild(name);
          button.className = "btn btn-primary";
          button.type = "button";
          button.value = "Add";
          button.onclick = function() { addItem(src, path, true); };
          cardBody.appendChild(button);

          card.align = "center";
          card.appendChild(cardBody);

          event.appendChild(card);
          deck.appendChild(event);
          container.append(deck);
        }
      }

    }
    
    function addItem(src, txt, addToDB){
      if(addToDB) {
        var addItemToList = firebase.functions().httpsCallable('addItemToGroceryList');
        addItemToList({uid: auth.currentUser.uid,
          src: src, txt: txt});
      }
      list.push({"src": src,
       "name": txt});
      let pos = list.name;

      let event1 = document.createElement('div');
      let card1 = document.createElement('div');
      let cardBody1 = document.createElement('div');
      let img1 = document.createElement('img');
      let name1 = document.createElement('h5');
      let node1 = document.createTextNode(txt);
      let button1 = document.createElement('input');

      card1.className = "card";
      img1.src = src;
      img1.className = "card-img-top";
        img1.width = "100";
      img1.height = "100";
      img1.alt = "Card image cap";
      card1.align = "center";
      card1.appendChild(img1);
      cardBody1.className = "card-body";
      name1.appendChild(node1);
      cardBody1.appendChild(name1);
      button1.className = "btn btn-danger";
      button1.type = "button";
      button1.value = "Remove";
      button1.onclick = function() { grocery.removeChild(event1);
      removeItem(pos, src, txt); 
    };        //event.innerHTML = ""; };
      cardBody1.appendChild(button1);
      card1.appendChild(cardBody1);
      event1.appendChild(card1);
      grocery.append(event1);

    }

    function removeItem(pos, src, txt){
      console.log({uid: auth.currentUser.uid, src: src, txt: txt})
      var removeItemFromList = firebase.functions().httpsCallable('removeItemFromGroceryList');
      removeItemFromList({uid: auth.currentUser.uid,
          src: src, txt: txt});
      list = list.splice(list.indexOf(pos));
    }


  </script>

</body>
</html>
